<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Live Market Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            backdrop-filter: blur(20px);
        }
        .header h1 {
            font-size: 2.8em;
            margin: 0 0 10px 0;
            background: linear-gradient(90deg, #00ff88, #00ccff, #ff6b6b);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }
        .stock-card {
            background: rgba(20,20,30,0.95);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.08);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            height: 450px;
        }
        .stock-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 35px 70px rgba(0,255,136,0.3);
        }
        .stock-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--card-color), transparent);
        }
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            position: relative;
            z-index: 10;
        }
        .stock-info h2 {
            margin: 0 0 15px 0;
            font-size: 22px;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .stock-price {
            font-size: 40px;
            font-weight: 900;
            margin: 10px 0;
            line-height: 1;
            text-shadow: 0 4px 20px rgba(0,255,136,0.3);
        }
        .change {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
        }
        .positive { 
            color: #00ff88; 
            background: rgba(0,255,136,0.2);
            box-shadow: 0 0 20px rgba(0,255,136,0.4);
        }
        .negative { 
            color: #ff4444; 
            background: rgba(255,68,68,0.2);
            box-shadow: 0 0 20px rgba(255,68,68,0.4);
        }
        .time-range {
            display: flex;
            gap: 8px;
        }
        .time-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 25px;
            background: rgba(80,80,100,0.6);
            color: #fff;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
            min-width: 45px;
        }
        .time-btn:hover, .time-btn.active {
            background: linear-gradient(135deg, #00ff88, #00ccff);
            box-shadow: 0 8px 25px rgba(0,255,136,0.5);
            transform: scale(1.05);
            border-color: #00ff88;
        }
        .live-status {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 12px;
            color: #00ff88;
            font-weight: 600;
            z-index: 10;
        }
        .live-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #00ff88;
            border-radius: 50%;
            margin-right: 6px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(1.2); }
        }
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 280px;  
            margin-top: 20px;
            border-radius: 20px;
            overflow: hidden;
            background: linear-gradient(145deg, rgba(0,0,0,0.8), rgba(40,40,60,0.6));
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }
        .chart-canvas-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 20px;  
            background: transparent;
        }
        canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }
        @media (max-width: 768px) {
            .stocks-grid { grid-template-columns: 1fr; }
            .stock-price { font-size: 32px; }
            .chart-wrapper { height: 250px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Live Market Dashboard</h1>
            <p>Live updates every 10s</p>
            <div><a style = "color:white" href="/watchlist">Go back to Watchlist</a></div>
        </div>
        
        <div class="stocks-grid" id="stocks-grid"></div>
    </div>

    <script>
        const STOCKS = [
            { symbol: 'MSFT', name: 'Microsoft Corporation', color: '#00ccff', basePrice: 420 },
            { symbol: 'AAPL', name: 'Apple Inc', color: '#ff6b6b', basePrice: 230 },
            { symbol: 'NKE', name: 'Nike, Inc', color: '#00ff88', basePrice: 85 },
            { symbol: 'GOOGL', name: 'Alphabet Inc (Google)', color: '#ffd700', basePrice: 180 },
            { symbol: 'AMZN', name: 'Amazon.com, Inc', color: '#ff9900', basePrice: 195 },
            { symbol: 'TSLA', name: 'Tesla, Inc', color: '#e31b23', basePrice: 250 },
            { symbol: 'META', name: 'Meta Platforms, Inc', color: '#4267B2', basePrice: 580 },
            { symbol: 'NVDA', name: 'NVIDIA Corporation', color: '#76b900', basePrice: 135 },
            { symbol: 'JPM', name: 'JPMorgan Chase & Co', color: '#0e3c90', basePrice: 210 },
            { symbol: 'V', name: 'Visa Inc', color: '#1a1f71', basePrice: 290 },
            { symbol: 'JNJ', name: 'Johnson & Johnson', color: '#0072bc', basePrice: 165 },
            { symbol: 'HD', name: "The Home Depot, Inc", color: '#febd17', basePrice: 380 }
        ];

        const TIME_RANGES = { '1w': 7, '1m': 30, '3m': 90, '1y': 365 };
        let charts = {}, currentRanges = {}, stockData = {};

        function getLivePrice(basePrice) {
            const volatility = 0.02;
            const now = Date.now();
            const minutes = (now % 86400000) / 60000;
            const trend = Math.sin(minutes / 1440 * Math.PI * 2) * 0.015;
            const noise = (Math.random() - 0.5) * volatility;
            return Math.max(1, basePrice * (1 + trend + noise));
        }

        function generateChartData(symbol, days) {
            const data = [];
            const endDate = new Date();
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(endDate);
                date.setDate(date.getDate() - i);
                const basePrice = STOCKS.find(s => s.symbol === symbol).basePrice;
                const volatility = 0.015;
                const trend = i < days * 0.3 ? -0.001 : 0.002;
                const price = basePrice * (1 + trend * i + (Math.random() - 0.5) * volatility * Math.sqrt(days));
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    close: Math.max(1, price + (Math.random() - 0.5) * 2)
                });
            }
            return data.reverse();
        }

        function createChart(ctx, data, color, range) {
            const canvasId = ctx.canvas.id;
            if (charts[canvasId]) charts[canvasId].destroy();

            const labels = data.slice(-25).map(d => {
                const date = new Date(d.date);
                if (range === '1w') return date.toLocaleString('en-US', { 
                    weekday: 'short', hour: 'numeric' 
                });
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        data: data.slice(-25).map(d => d.close),
                        borderColor: color,
                        backgroundColor: color + '20',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 3,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,  
                    layout: {
                        padding: {
                            left: 10,
                            right: 10,
                            top: 10,
                            bottom: 10
                        }
                    },
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15,15,25,0.95)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            cornerRadius: 12,
                            padding: 12
                        }
                    },
                    scales: {
                        x: { 
                            grid: { 
                                color: 'rgba(255,255,255,0.08)',
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: { 
                                color: '#999',
                                maxRotation: 45,
                                font: { size: 11, family: '-apple-system' },
                                padding: 8,
                                maxTicksLimit: 8
                            },
                            border: {
                                display: false
                            }
                        },
                        y: {
                            grid: { 
                                color: 'rgba(255,255,255,0.05)',
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: { 
                                color: '#999',
                                font: { size: 11, family: '-apple-system' },
                                padding: 8,
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    },
                    interaction: { 
                        intersect: false, 
                        mode: 'index' 
                    },
                    elements: {
                        point: { radius: 0 }
                    }
                }
            });
        }

        function updateStockCard(stock) {
            const symbol = stock.symbol;
            const card = document.getElementById(`card-${symbol}`);
            if (!card) return;

            const priceEl = card.querySelector('.stock-price');
            const changeEl = card.querySelector('.change');
            const chartCanvas = card.querySelector('canvas');
            const ctx = chartCanvas.getContext('2d');
            const range = currentRanges[symbol] || '1w';

            const currentPrice = getLivePrice(stock.basePrice);
            const prevPrice = stockData[symbol]?.price || currentPrice;
            const changePercent = ((currentPrice - prevPrice) / prevPrice * 100);
            
            stockData[symbol] = { price: currentPrice, change: changePercent };

            const changeClass = changePercent >= 0 ? 'positive' : 'negative';
            priceEl.textContent = `$${currentPrice.toFixed(2)}`;
            priceEl.className = `stock-price ${changeClass}`;
            changeEl.textContent = `${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%`;
            changeEl.className = `change ${changeClass}`;

            const chartData = generateChartData(symbol, TIME_RANGES[range]);
            createChart(ctx, chartData, stock.color, range);
        }

        function createStockCard(stock) {
            const div = document.createElement('div');
            div.id = `card-${stock.symbol}`;
            div.className = 'stock-card';
            div.style.setProperty('--card-color', stock.color);
            currentRanges[stock.symbol] = '1w';

            div.innerHTML = `
                <div class="live-status">
                    <span class="live-dot"></span>Live
                </div>
                <div class="stock-header">
                    <div class="stock-info">
                        <h2>${stock.name}</h2>
                        <p class="stock-price">$0.00</p>
                        <p class="change">0.00%</p>
                    </div>
                    <div class="time-range">
                        <button class="time-btn active" data-range="1w">1W</button>
                        <button class="time-btn" data-range="1m">1M</button>
                        <button class="time-btn" data-range="3m">3M</button>
                        <button class="time-btn" data-range="1y">1Y</button>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-canvas-wrapper">
                        <canvas id="chart-${stock.symbol}"></canvas>
                    </div>
                </div>
            `;

            div.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    div.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentRanges[stock.symbol] = btn.dataset.range;
                    updateStockCard(stock);
                });
            });

            return div;
        }

        function init() {
            const grid = document.getElementById('stocks-grid');
            STOCKS.forEach(stock => grid.appendChild(createStockCard(stock)));

            STOCKS.forEach((stock, i) => {
                setTimeout(() => updateStockCard(stock), i * 100);
            });

            setInterval(() => {
                STOCKS.forEach(stock => updateStockCard(stock));
            }, 10000);
        }

        init();
    </script>
</body>
</html>
