 <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo">
            <i class="fa-solid fa-chart-line"></i>
            <span class="nav-text">StockAI</span>
        </div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="showSection('dashboard')">
                <i class="fa-solid fa-grip"></i> <span class="nav-text">Dashboard</span>
            </li>
            <li class="nav-item" onclick="showSection('watchlist')">
                <i class="fa-regular fa-star"></i> <span class="nav-text">Watchlist</span>
            </li>
            <li class="nav-item" onclick="showSection('portfolio')">
                <i class="fa-solid fa-briefcase"></i> <span class="nav-text">Portfolio</span>
            </li>
            <li class="nav-item" onclick="showSection('alerts')">
                <i class="fa-solid fa-bell"></i> <span class="nav-text">Alerts</span>
            </li>
            <li class="nav-item" onclick="showSection('ai-chat')">
                <i class="fa-solid fa-robot"></i> <span class="nav-text">AI Analyst</span>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="dashboard-grid">
                <!-- Top Stats -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Current Price</span>
                        <i class="fa-solid fa-tag text-muted"></i>
                    </div>
                    <div class="card-value" id="dash-price">--</div>
                    <div class="card-sub" id="dash-change">--</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Volume</span>
                        <i class="fa-solid fa-layer-group text-muted"></i>
                    </div>
                    <div class="card-value" id="dash-volume">--</div>
                    <div class="card-sub">24h Traded</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">P/E Ratio</span>
                        <i class="fa-solid fa-percent text-muted"></i>
                    </div>
                    <div class="card-value" id="dash-pe">--</div>
                    <div class="card-sub">Trailing 12M</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Market Cap</span>
                        <i class="fa-solid fa-building text-muted"></i>
                    </div>
                    <div class="card-value" id="dash-mcap">--</div>
                    <div class="card-sub">Est. Valuation</div>
                </div>

                <!-- Chart Controls -->
                <div class="card control-panel">
                    <div>
                        <label style="display:block; color:var(--text-muted); font-size:0.8rem; margin-bottom:0.5rem;">Select Stock</label>
                        <select id="stock-select" class="stock-selector" onchange="changeStock(this.value)">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label style="display:block; color:var(--text-muted); font-size:0.8rem; margin-bottom:0.5rem;">Timeframe</label>
                        <div class="time-filters">
                            <button class="filter-btn active" onclick="setChartPeriod('1D')">1D</button>
                            <button class="filter-btn" onclick="setChartPeriod('1W')">1W</button>
                            <button class="filter-btn" onclick="setChartPeriod('1M')">1M</button>
                        </div>
                    </div>
                    <div style="margin-top:auto;">
                        <div class="card-title">AI Sentiment</div>
                        <div id="ai-sentiment" class="text-green" style="font-weight: 700; font-size: 1.2rem; margin-top:0.5rem;">NEUTRAL</div>
                        <div class="card-sub" style="font-size:0.75rem;">Based on revenue & PE</div>
                    </div>
                </div>

                <!-- Main Chart -->
                <div class="card chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Watchlist Section -->
        <section id="watchlist" class="section">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fa-regular fa-star"></i> My Watchlist</h2>
                    <div>
                        <input type="text" id="watchlist-search" placeholder="Add Symbol" class="stock-selector" style="width:200px; display:inline-block;">
                        <button class="btn btn-primary" onclick="addToWatchlist()"><i class="fa-solid fa-plus"></i> Add</button>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Price</th>
                            <th>Change %</th>
                            <th>Volume</th>
                            <th>PE Ratio</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="watchlist-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Portfolio Section -->
        <section id="portfolio" class="section">
            <div class="portfolio-summary">
                <div class="card">
                    <div class="card-header"><h2>Portfolio Value</h2></div>
                    <div class="card-value" id="port-total-val">₹0.00</div>
                    <div class="card-sub" id="port-pl">₹0.00 (0.00%)</div>
                </div>
                <div class="card pie-chart-wrapper">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Holdings</h2>
                    <div>
                        <button class="btn btn-danger" onclick="clearPortfolio()"><i class="fa-solid fa-trash"></i> Clear All</button>
                        <button class="btn btn-primary" onclick="openAddHoldingModal()"><i class="fa-solid fa-plus"></i> Add Holding</button>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Qty</th>
                            <th>Avg Buy Price</th>
                            <th>Cur Price</th>
                            <th>Value</th>
                            <th>P/L</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="portfolio-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Alerts Section -->
        <section id="alerts" class="section">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fa-solid fa-bell text-orange"></i> Price Alerts</h2>
                    <button class="btn btn-danger" onclick="clearAlerts()"><i class="fa-solid fa-trash"></i> Clear All</button>
                </div>
                
                <div class="alert-grid">
                    <div class="form-group">
                        <label>Stock</label>
                        <select id="alert-symbol" class="form-control">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Condition</label>
                        <select id="alert-condition" class="form-control">
                            <option value=">">Price Goes Above (>)</option>
                            <option value="<">Price Drops Below (<)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Target Price (₹)</label>
                        <input type="number" id="alert-price" class="form-control" placeholder="Target Price">
                    </div>
                    <div class="form-group">
                        <label style="opacity:0">Action</label>
                        <button class="btn btn-warning" onclick="addAlert()" style="width:100%"><i class="fa-solid fa-plus"></i> Set Alert</button>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Stock</th>
                            <th>Condition</th>
                            <th>Target Price</th>
                            <th>Current Price</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="alerts-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- AI Chat Section -->
        <section id="ai-chat" class="section">
            <div class="card chat-container">
                <div class="card-header">
                    <h2><i class="fa-solid fa-robot"></i> AI Market Analyst</h2>
                    <span class="card-title">Ask about stocks, risk, or trends.</span>
                </div>
                <div class="chat-window" id="chat-window">
                    <div class="message bot">
                        Hello! I'm your AI Market Analyst. I have access to the provided dataset containing fundamentals like P/E, Revenue, and Debt. 
                        <br><br>
                        Try asking:
                        <br>• "Should I buy TCS?"
                        <br>• "Compare INFY vs TCS"
                        <br>• "Analyze my portfolio risk"
                        <br>• "Show me high growth stocks"
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Type your question here..." onkeypress="handleChatKey(event)">
                    <button class="send-btn" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </section>

    </main>

    <!-- Modals -->
    
    <!-- Add Holding Modal -->
    <div id="add-modal" class="modal-overlay">
        <div class="modal">
            <h3>Add New Holding</h3>
            <div class="form-group">
                <label>Select Stock</label>
                <select id="modal-stock-select" class="form-control">
                    <!-- Populated by JS -->
                </select>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <input type="number" id="modal-qty" class="form-control" placeholder="e.g. 10" min="1">
            </div>
            <div class="form-group">
                <label>Avg Buy Price (₹)</label>
                <input type="number" id="modal-price" class="form-control" placeholder="e.g. 2500" min="1">
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="closeModal('add-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmAddHolding()">Add to Portfolio</button>
            </div>
        </div>
    </div>

    <!-- Sell Confirmation Modal -->
    <div id="sell-modal" class="modal-overlay">
        <div class="modal">
            <h3 style="color: var(--red)"><i class="fa-solid fa-triangle-exclamation"></i> Confirm Sell</h3>
            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                Are you sure you want to sell <strong id="sell-stock-name"></strong>?
                <br>This action cannot be undone.
            </p>
            <div class="modal-actions">
                <button class="btn" style="background: var(--border); color:white" onclick="closeModal('sell-modal')">Cancel</button>
                <button class="btn btn-danger" onclick="executeSell()">Confirm Sell</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
